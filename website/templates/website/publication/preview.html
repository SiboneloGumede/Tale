{%extends 'website/base.html'%}
{%load static%}

{%block title%}{{article.title}} | Tale{%endblock%}

{%block header%}
<header class="navbar navbar-expand-lg navbar-end navbar-sticky-top navbar-dark bg-success">
  <div class="container">
    <div class="navbar-nav-wrap">
      <div class="navbar-brand-wrapper">
        <a class="link text-white" href="{%url 'website:step-3' article.pk%}">
          <i class="bi-chevron-left small ms-1"></i> Go back
        </a>
      </div>

      <!-- Toggle -->
      <button type="button" class="navbar-toggler ms-auto" data-bs-toggle="collapse" data-bs-target="#navbarNavMenuDark" aria-label="Toggle navigation" aria-expanded="false" aria-controls="navbarNavMenuDark">
        <span class="navbar-toggler-default">
          <i class="bi-list"></i>
        </span>
        <span class="navbar-toggler-toggled">
          <i class="bi-x"></i>
        </span>
      </button>
      <!-- End Toggle -->

      <nav class="navbar-nav-wrap-col collapse navbar-collapse" id="navbarNavMenuDark">
        <!-- Navbar -->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active text-decoration-underline" href="{%url 'website:ajax-delete-publication' article.pk%}">Delete</a>
          </li>

          <li class="nav-item">
            <a class="nav-link active text-decoration-underline" href="{%url 'website:ajax-publish-publication' article.pk%}">Publish</a>
          </li>

        </ul>
        <!-- End Navbar -->
      </nav>
    </div>
  </div>
</header>
{%endblock%}

{%block content%}
<main id="content" role="main">
    <!-- Article Description -->
    <div class="container content-space-t-3 content-space-t-lg-4 content-space-b-2">
      <div class="w-lg-65 mx-lg-auto">
        <div class="mb-4">
          <h1 class="h2">{{article.title}}</h1>
        </div>

        <div class="row align-items-sm-center mb-5">
          <div class="col-sm-7 mb-4 mb-sm-0">
            <!-- Media -->
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <img class="avatar avatar-circle" src="{{article.user.gravatar}}" alt="Image Description">
              </div>

              <div class="flex-grow-1 ms-3">
                <h5 class="mb-0">
                  <a class="text-dark" href="{%url 'website:author-select' article.user.pk article.user.username%}">{{article.user.get_full_name}}</a>
                </h5>
                <span class="d-block small">{{article.date|date:'d F Y'}}</span>
              </div>
            </div>
            <!-- End Media -->
          </div>
          <!-- End Col -->

          <div class="col-sm-5">
            <div class="d-flex justify-content-sm-end align-items-center">
              <span class="text-cap mb-0 me-2">Share:</span>

              <div class="d-flex gap-2">
                <button class="btn btn-soft-secondary btn-sm btn-icon rounded-circle" onclick="copyToClipboard();">
                  <i class="bi-link"></i>
                </button>
               
              </div>
            </div>
          </div>
          <!-- End Col -->
        </div>
        <!-- End Row -->

        <p>{{article.blurb|safe|linebreaks}}</p>
      </div>
{% load static %}

<div class="my-4 my-sm-8 text-center">
    <img class="img-fluid rounded-lg" 
         src="{% if Article.image %}{{ Article.image.url }}{% else %}{% static 'assets/img/tale/tale-logo.png' %}{% endif %}" 
         alt="{{ Article.title }}">
</div>

      <div class="w-lg-65 mx-lg-auto">
        <p>{{article.body|safe|linebreaks}}</p>
      </div>

      <div class="w-lg-65 mx-lg-auto">

        <!-- Badges -->
        <div class="mt-5">
          {%for tag in tags%}
          <a class="btn btn-soft-secondary btn-xs m-1" href="{%url 'website:tags' tag%}">{{tag}}</a>
          {%endfor%}
        </div>
        <!-- End Badges -->

        <div class="row justify-content-sm-between align-items-sm-center mt-5">
          <div class="col-sm mb-2 mb-sm-0">
            <div class="d-flex align-items-center">
              <span class="text-cap mb-0 me-2">Share:</span>

              <button class="btn btn-ghost-secondary btn-sm btn-icon rounded-circle me-2" onclick="copyToClipboard();">
                <i class="bi-link"></i>
              </button>
              
            </div>
          </div>
          <!-- End Col -->

          <div class="col-sm-auto">
            <form action="{%url 'website:ajax-bookmark-article' user.pk article.pk%}" id="bookmark-form">
              {%csrf_token%}
              <button type="submit" class="btn btn-soft-secondary btn-sm btn-icon rounded-circle" data-toggle="tooltip" data-placement="top" title="Bookmark article" id="bookmark-sub">
                <i class="bi-bookmark"></i>
              </button>
            </form>
            
          </div>
          <!-- End Col -->

        </div>
        <!-- End Row -->
      </div>
    </div>
    <!-- End Article Description -->

    <!-- User Profile -->
    <div class="container content-space-t-1">
      <div class="row justify-content-lg-center">
        <div class="col-lg-8">
          <div class="mb-5">
            <h4>About the author</h4>
          </div>

          <!-- Media -->
          <div class="d-sm-flex">
            <div class="flex-shrink-0 mb-3 mb-sm-0">
              <img class="avatar avatar-xl avatar-circle" src="{{article.user.gravatar}}" alt="Image Description">
            </div>

            <div class="flex-grow-1 ms-sm-4">
              <!-- Media -->
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">
                  <a class="text-dark" href="{%url 'website:author-select' article.user.pk article.user.username%}">{{article.user.get_full_name}}</a>
                </h3>
                <button type="button" class="btn btn-outline-primary btn-sm">
                  <i class="bi-person-plus-fill me-1"></i> Subscribe
                </button>
              </div>
              <!-- End Media -->

              <p>{{article.user.bio}}</p>
            </div>
          </div>
          <!-- End Media -->
        </div>
      </div>
    </div>
    <!-- End User Profile -->

    <!-- Comment -->
    <div class="container content-space-1 content-space-lg-3">
      <!-- Heading -->
      <div class="w-md-75 w-lg-50 text-center mx-md-auto mb-5 mb-md-9">
        <h2>Post a comment</h2>
      </div>
      <!-- End Heading -->

      <div class="row justify-content-lg-center">
        <div class="col-lg-8">
          <!-- Comment -->
          	<div id="disqus_thread"></div>
          	<script>
			    /**
			    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
			    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
			    
			    var disqus_config = function () {
			    this.page.url = "http://127.0.0.1:8000/{{article.pk}}/{{article.slug}}/";  // Replace PAGE_URL with your page's canonical URL variable
			    this.page.identifier = "{{article.page_identifier}}"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
			    };
			    
			    (function() { // DON'T EDIT BELOW THIS LINE
			    var d = document, s = d.createElement('script');
			    s.src = 'https://tale-2.disqus.com/embed.js';
			    s.setAttribute('data-timestamp', +new Date());
			    (d.head || d.body).appendChild(s);
			    })();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <!-- End Comment -->
        </div>
        <!-- End Col -->
      </div>
      <!-- End Row -->
    </div>
    <!-- End Comment -->
    <script id="dsq-count-scr" src="//tale-2.disqus.com/count.js" async></script>
</main>

<script type="text/javascript">
  function copyToClipboard(text) {
    var inputc = document.body.appendChild(document.createElement("input"));
    inputc.value = window.location.href;
    inputc.focus();
    inputc.select();
    document.execCommand('copy');
    inputc.parentNode.removeChild(inputc);
    alert("URL Copied.");
  }
</script>
{%endblock%}

{%block header_js%}

{%endblock%}